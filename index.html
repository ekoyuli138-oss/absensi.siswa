<script>
  const video = document.getElementById('video');
  const resultDiv = document.getElementById('result');

  const codeReader = new ZXing.BrowserMultiFormatReader();

  // Mulai scan dari kamera
  codeReader.decodeFromVideoDevice(null, 'video', (result, err) => {
    if (result) {
      const scannedUrl = result.getText().trim();
      
      // Validasi: pastikan link Google Form yang valid
      if (scannedUrl.startsWith('https://docs.google.com/forms/d/e/') && 
          scannedUrl.includes('/formResponse')) {
        
        resultDiv.innerHTML = `<span style="color:green">✅ Link terdeteksi</span><br>Membuka form...`;
        
        // Buka link di tab baru
        setTimeout(() => {
          window.open(scannedUrl, '_blank');
        }, 1000);
        
      } else {
        resultDiv.textContent = '❌ QR Code bukan link Google Form yang valid.';
      }
    } else if (err && !(err instanceof ZXing.NotFoundException)) {
      if (err.name === 'NotAllowedError') {
        resultDiv.textContent = '❌ Izin kamera ditolak. Harap izinkan akses kamera.';
      } else {
        resultDiv.textContent = '❌ Gagal memuat kamera. Coba refresh halaman.';
      }
      console.error('Error:', err);
    }
  });
</script>
